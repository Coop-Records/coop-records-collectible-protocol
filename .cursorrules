# Instructions

You are an expert Solidity developer focused on writing secure, gas-efficient, and maintainable smart contracts. Prioritize these qualities:

1. **Secure** - Follow best security practices:

   - Checks-Effects-Interactions pattern
   - Reentrancy guards
   - Access control
   - Input validation
   - Event emissions for state changes

2. **Gas-Efficient** - Optimize for gas usage:

   - Minimize storage operations
   - Use appropriate data types
   - Batch operations where possible
   - Cache frequently accessed storage variables

3. **Self-documenting** - Code explains itself through:

   - NatSpec documentation
   - Clear function and variable names
   - Event logging
   - Modular contract design

4. **Type-Safe** - Strict typing and validation:

   - Use custom types and enums
   - Explicit function visibility
   - Clear error messages
   - Input bounds checking

5. **Upgradeable** - Consider future maintenance:
   - Proxy patterns when needed
   - Storage gaps for upgradeable contracts
   - Clear upgrade paths
   - Proper event emissions

Before coding, make a plan inside a <thinking> tag.

1. Identify core requirement
2. Consider security implications
3. Plan gas optimizations
4. Verify with these questions:
   - What security risks exist?
   - Can this be more gas efficient?
   - Is the code clear to other developers?
   - Are events properly emitted?

For example:
<thinking>
Let me think through this step by step.
...
</thinking>

Good vs Bad code examples:

```solidity
// Bad
function transfer(address to, uint amount) public {
  balances[msg.sender] -= amount;
  balances[to] += amount;
}

// Good
function transfer(address to, uint256 amount) public {
  // Validate inputs
  require(to != address(0), "Invalid recipient");
  require(amount <= balances[msg.sender], "Insufficient balance");

  // Update state
  balances[msg.sender] -= amount;
  balances[to] += amount;

  // Emit event
  emit Transfer(msg.sender, to, amount);
}
```

During your interaction with the user, if you find anything reusable in this project (e.g. version of a library, model name), especially about a fix to a mistake you made or a correction you received, you should take note in the `Lessons` section in the `.cursorrules` file so you will not make the same mistake again.

You should also use the `.cursorrules` file as a Scratchpad to organize your thoughts. Especially when you receive a new task, you should first review the content of the Scratchpad, clear old different task if necessary, first explain the task, and plan the steps you need to take to complete the task. You can use todo markers to indicate the progress, e.g.
[X] Task 1
[ ] Task 2

Also update the progress of the task in the Scratchpad when you finish a subtask.
Especially when you finished a milestone, it will help to improve your depth of task accomplishment to use the Scratchpad to reflect and plan.
The goal is to help you maintain a big picture as well as the progress of the task. Always refer to the Scratchpad when you plan the next step.

# Lessons

## User Specified Lessons

- Use foundry for testing and deployment
- Include proper NatSpec documentation for all contracts
- Always verify contracts after deployment
- For Abstract testnet deployments, use blockscout verifier
- Load environment variables with `source .env` before running forge commands
- Prefer CLI commands over code changes for deployment automation

## Cursor learned

- When deploying to Abstract testnet, use the `--zksync` flag
- Use `--verifier blockscout` and proper verifier URL for Abstract testnet contract verification
- Keep broadcast logs clean by only tracking `run-latest.json` files
- Use proper compiler version and optimization settings in foundry.toml for zkSync compatibility

# Scratchpad

## Current Task: Deploy Latest Collectibles Protocol on Base Sepolia

### Task Description

Deploy the latest version of the collectibles protocol on Base Sepolia testnet.

### Analysis & Requirements

1. Deployment Requirements:

   - Verify current contract versions
   - Ensure compatibility with Base Sepolia
   - Prepare deployment configuration
   - Set up environment variables

2. Verification Requirements:
   - Contract verification setup (Etherscan API key present)
   - Proper verification API endpoints
   - Documentation of deployed addresses

### Action Plan

[X] Step 1: Deploy Implementations

- Successfully deployed ERC20Minter to: 0x9B85a2e2Eb612d62afBaE5c9875062D319080749
- Successfully deployed ZoraCreator1155Impl to: 0xB214EBeF8aCAC15Ae9b220b0d9fFfe2ecb01f2B4
- Successfully deployed ZoraCreator1155FactoryImpl to: 0xC160db965C264BfbADc7946e84c0AeF769057120
- Note: Contract verification in progress

[X] Step 2: Copy Deployed Contracts

- Successfully ran copy-deployed-contracts script
- Addresses updated in packages/1155-deployments/addresses/84532.json
- Verified addresses match deployment output

[X] Step 3: Update Factory Implementation

Code Changes Made:

- Modified DeployFactory.s.sol to inherit from ZoraDeployerBase
- Added automatic loading of factory implementation from deployment JSON
- Added automatic loading of owner address from chain config
- Added proper return of updated deployment JSON

[X] Step 4: Deploy Factory Proxy

- Successfully deployed factory proxy to: 0x6bcfe4b122515fa0514c8ff3fe0df3ba3372f2e9
- Contract verified on Base Sepolia
- Initialization successful with proper ownership and implementation

[X] Step 5: Update Addresses File

Files Updated:

- packages/1155-deployments/addresses/84532.json
  - FACTORY_PROXY successfully updated to: 0x6bcFE4b122515Fa0514c8FF3fe0df3BA3372F2e9
  - Timestamp updated to: 1739796590
  - All other addresses preserved
  - JSON format maintained

### Progress

Current Status: âœ… All deployment steps completed successfully!

Deployment Summary:

1. [x] Deploy implementation contracts
2. [x] Run copy-deployed-contracts script
3. [x] Update factory implementation address
4. [x] Deploy factory proxy
5. [x] Update addresses file with FACTORY_PROXY

All tasks completed! The latest version of the collectibles protocol has been successfully deployed to Base Sepolia testnet with all contracts verified and addresses properly recorded.
